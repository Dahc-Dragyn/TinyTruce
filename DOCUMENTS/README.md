# TinyTruce: Geopolitical Conflict Lab (2026) ğŸŒğŸ¤

> *â€œPeace is not the absence of conflict, but the presence of creative alternatives for responding to conflict.â€* â€” Dorothy Thompson

**TinyTruce** is a specialized fork of Microsoft's [TinyTroupe](https://github.com/microsoft/tinytroupe), re-engineered for high-fidelity geopolitical simulations. It places AI agentsâ€”representing world leaders, tech CEOs, and religious figuresâ€”into complex, near-future scenarios (2025-2026) to explore negotiation dynamics, red lines, and potential de-escalation pathways.

Unlike standard agent simulations that focus on generic interactions, TinyTruce is built on **Forensic Grounding**: every scenario is backed by real-world treaties, technical whitepapers, and economic reports to ensure the agents are debating facts, not hallucinations.

---

### 1. Unified Pydantic Validation Layer
TinyTruce implements a strict "fail-fast" validation layer for all JSON assets (personas and scenarios) using Pydantic.
- **Fail-Fast Deployment**: The `AssetManager` performs schema validation *before* the simulation initializes. If a JSON file has a misspelled key or missing required block, the system halts with a verbose error report.
- **Backward Compatible**: The schemas are engineered to be highly permissive. They support missing sections (fragments) and **ignore unknown keys** via `extra='ignore'`. This ensures all existing JSON assets load successfully while still enforcing structure on core fields.
- **Data Integrity**: Ensures that simulation metrics (Mood Bars, Psychological Momentum) are never zeroed out by malformed LLM responses.

### 2. LLM Engine Abstraction (Provider-Agnostic)
The core simulation logic is decoupled from specific LLM providers via a robust abstraction layer in `llm_engine.py`.
- **Native Gemini Integration**: The `NativeGeminiEngine` communicates directly with the Gemini API (v1.x), bypassing the need for "OpenAI-shaped" translation layers.
- **Explicit Context Caching**: Large forensic profiles (Atlas, Layer 0 traits) are anchored once and reused across turns, reducing input token costs by **50%+**.
- **Identity Retention Locks**: A terminal `CRITICAL IDENTITY LOCK` is injected into the input stream right before JSON execution to prevent context-caching genericization.
- **Zero-Cost Cache Verification**: Use `verify_cache.py` to audit live backend cache hits without incurring token billing.
- **World State Logic**: A global context file (`../data/facts/world-facts.2026.txt`) ensures all agents share the same timeline and geopolitical reality.

### 3. The Scenario Board (Layer 1)
Scenarios are defined in JSON files in the `scenarios/` directory. Each scenario includes:
- **Initial Broadcast**: The "breaking news" that starts the conflict.
- **Intervention Protocol (Semantic Nudge)**: A predefined "Peace Bomb" or "Crisis Escalation" that triggers if an invisible LLM monitor detects a stalemate in conversation. Injects an internal psychological nudge into the agents to change tactics.
- **Dynamic Injects (Procedural Crisis)**: Probability-based mid-simulation external events generated by dice rolls (e.g., 25% chance of firing after Turn 6). These force agents to react to sudden, unpredictable shifts in the narrative without being explicitly told how to feel about them. *Can be disabled via `--disable-injects`.*
- **Scenario Allegory Map (SAM)**: A "Shadow Dictionary" of allegories (e.g., "Heresy" -> "Signal Drift") that allows agents to discuss sensitive topics without triggering safety filters.

### 4. Persona Bifurcation (Linguistic Realism)
TinyTruce solves the "LLM Leak" problem (where agents sound like polite chatbots) by bifurcating high-profile personas:
- **Unscripted Mode**: Focused on forensic linguistic constraints (e.g., *Parataxis*, *The Weave*). Agents abandon sentence structures mid-thought and use aggressive "Anti-Wonk" vocabulary. 
- **Scripted/SOTU Mode**: Optimized for formal, linear delivery (e.g., State of the Union). High-fidelity teleprompter cadence with integrated catchphrases.

### 5. Forensic Allegories & Resiliency
To maintain simulation integrity during high-stakes theological or political debates, TinyTruce implements:
- **Diplomatic Pivots**: If an LLM response is blocked by safety filters, the agent automatically pivots to a persona-specific "safe" response.
- **Forensic Allegories**: Agents use metaphorical language to bypass keyword-based filters while retaining semantic intensity.
- **Identity Reinforcement**: The engine calls an internal `think()` action before every turn to refresh the agent's specific identity and purge "Context Bleed" from other participants' vocabularies.

### 6. The Narrator & Roast Mode (Layer 2.5)
- **Narrator**: A "Salty British Documentarian" who provides dry, observational commentary every 5 turns.
- **Roast Recap (V2 Engine)**: At the end of the simulation, a "Jaded UN Bartender" generates a highly structured, forensic roast of the participants. The V2 engine uses Sam Morril-style comedic patterns, including Archetypal Reduction, Grime Anchoring, and a Compression Governor, to deliver a clinical, detached critique of structural and diplomatic failures.

---

## ğŸ› ï¸ Installation

1.  **Clone the repository**:
    ```bash
    git clone <repository-url>
    cd TinyTruce
    ```

2.  **Create and activate a virtual environment**:
    ```bash
    python -m venv venv
    .\venv\Scripts\activate
    ```

3.  **Install dependencies**:
    ```bash
    pip install -r requirements.txt
    ```
    *(Note: TinyTruce relies on `tinytroupe`, `rich`, `openai`, and `google-generativeai`)*

4.  **Configure API Keys**:
    - Create a `.env` file or set environment variables for `OPENAI_API_KEY` (or `GOOGLE_API_KEY` if using Gemini).
    - Checks `config.ini` for model settings.

---

## ğŸ“– Usage

### Running a Simulation

Use the `tinytruce_sim.py` script to launch a scenario.

**Basic Usage:**
```bash
python tinytruce_sim.py --scenario <scenario_key>
```

**Advanced Usage (Vatican Cyber-Schism):**
```bash
python tinytruce_sim.py --scenario vatican_cyber-schism --turns 10 --agents pope_leo.agent.json yann_lecun.agent.json sam_altman.agent.json --fragments pope_leo_preserver.fragment.json purist_reformer.fragment.json reformer.fragment.json --narrator salty --roast-level nuclear
```

**High-Fidelity Negotiation (Unscripted Mode):**
```bash
python tinytruce_sim.py --scenario ukraine --turns 10 --agents volodymyr_zelensky.agent.json vladimir_putin.agent.json donald_trump_unscripted.agent.json --hide-thoughts --roast-level nuclear
```

**Monologue Delivery (SOTU/Scripted Mode):**
```bash
python tinytruce_sim.py --scenario sotu_delivery --turns 6 --agents donald_trump_sotu.agent.json --monologue --hide-thoughts
```

**Clean Run (No Dynamic Crisis Injects):**
```bash
python tinytruce_sim.py --scenario petrodollar_pivot --disable-injects
```
*Tip: We recommend 8-10 turns for static scenarios to prevent agents from falling into cyclical, repetitive arguments about their core philosophies.*

### Available Scenarios (`scenarios/`)
-   `sotu_delivery`: A scripted, linear delivery of the 2026 State of the Union address by Donald J. Trump (Requires `--monologue` flag).
-   `sotu_crisis`: An interactive "War Room" negotiation just prior to the SOTU address, reacting to a real-time grid emergency.
-   `vatican_cyber-schism`: Pope Leo XIV vs. Tech CEOs on AI "Souls" and Digital Sacraments.
-   `neural_sovereignty_accord`: EU regulators vs. US Tech Giants on "Cognitive Data Rights".
-   `lunar_gateway_jurisdiction`: US vs. China vs. Private Sector on lunar mining rights.
-   `lithium_triangle_leverage`: South American leaders vs. Global Markets on lithium nationalization.
-   `blue_nile_brinkmanship`: Egypt vs. Ethiopia on the Grand Ethiopian Renaissance Dam (GERD).

### Viewing Results
After a simulation completes, check the following files:
-   `tinytruce_briefing.md`: A formal strategic audit of the negotiation, including a "Resolve Scorecard" and "Redline Breach Report".
-   `tinytruce_roast.md`: The "Jaded UN Bartender" recap.
-   `tinytruce_results.json`: Raw data export.
-   `tinytruce_simulation.log`: Full debug logs (if enabled in `config.ini`).

---

## ğŸ¨ Frontend Integration

For developers building external interfaces or dashboards for TinyTruce:
- **Canonical Reference**: See [FRONTEND_NOTES.md](FRONTEND_NOTES.md) for data schemas, simulation parameters, and output artifact structures.
- **Real-time UX**: Supports `God Mode` (thinking logs + mood bars) and `Story Mode` (clean chat bubbles).

---

## ğŸ“‚ Project Structure

```
TinyTruce/
â”œâ”€â”€ DOCUMENTS/              # Documentation & Reports
â”‚   â”œâ”€â”€ README.md           # Project Overview
â”‚   â”œâ”€â”€ FRONTEND_NOTES.md   # UI Integration Data Sheet
â”‚   â”œâ”€â”€ tinytruce_briefing.md # Last Simulation Audit
â”‚   â””â”€â”€ tinytruce_roast.md   # Last Bartender Recap
â”œâ”€â”€ data/                   # Forensic Grounding Files
â”‚   â”œâ”€â”€ facts/              # Global world state (2026)
â”‚   â”œâ”€â”€ treaties/           # Real-world treaty texts
â”‚   â”œâ”€â”€ tech/               # Technical whitepapers/leaks
â”‚   â”œâ”€â”€ economics/          # IMF/World Bank reports
â”‚   â””â”€â”€ theology/           # Religious encyclicals
â”œâ”€â”€ personas/               # Agent Definitions
â”‚   â”œâ”€â”€ agents/             # Base profiles (Pope, LeCun, Altman, etc.)
â”‚   â””â”€â”€ fragments/          # Behavioral overlays (Preserver, Reformer)
â”œâ”€â”€ scenarios/              # Scenario JSON configurations
â”œâ”€â”€ tinytroupe/             # Core library (Modified)
â”‚   â”œâ”€â”€ agent/              # TinyPerson logic (Resilience)
â”‚   â””â”€â”€ ...
â”œâ”€â”€ tinytruce_sim.py        # Main simulation entry point
â”œâ”€â”€ config.ini              # Configuration (Models, Logging)
â””â”€â”€ requirements.txt        # Python dependencies
```

---

## âš–ï¸ Disclaimer

**TinyTruce** is an experimental research tool that uses Large Language Models (LLMs) to generate content. The output is stochastic and may contain hallucinations or inaccuracies. The views expressed by the simulated agents do not reflect the views of the creators or any affiliated organizations. This tool is for **imagination enhancement** and **strategic exploration** only.

*Based on [TinyTroupe](https://github.com/microsoft/tinytroupe) by Microsoft Research.*
